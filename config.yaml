# ===================================================================
#      Configuration for DTI Prediction Project (v4.2)
# ===================================================================
# This is the final, fully-featured config BEFORE Hydra refactoring.
# It uses a single file to manage all experimental parameters.

# ===================================================================
# 1. Data Configuration
# ===================================================================
data:
  root: "data"
  primary_dataset: "DrugBank"  # Options: "DrugBank", "davis", "biosnap"
  
  # This flag is used by data_proc.py to decide which data variant to GENERATE.
  use_gtopdb: false
  
  subfolders:
    raw: "raw"
    processed: "processed"

  files:
    DrugBank:
      raw:
        dti_interactions: "full.csv"
        columns: { drug_id: "SMILES", target_id: "Protein", label: "Y" }
      processed:
        typed_edge_list_template: "typed_edges_suffix-{relations_suffix}.csv"
        link_prediction_labels: "dl_p_edges.csv"
        nodes_metadata: "nodes.csv"
        node_features: "features.csv"
        similarity_matrices:
          molecule: "sim_matrixes/dl_similarity_matrix.pkl"
          protein: "sim_matrixes/prot_similarity_matrix.pkl"
        indexes:
          drug: "indexes/drug2index.pkl"
          ligand: "indexes/ligand2index.pkl"
          protein: "indexes/prot2index.pkl"
          
    davis:
      raw:
        dti_interactions: "full.csv"
        columns: { drug_id: "SMILES", target_id: "Protein", label: "Y" }
      processed:
        typed_edge_list_template: "typed_edges_suffix-{relations_suffix}.csv"
        link_prediction_labels: "dl_p_edges.csv"
        nodes_metadata: "nodes.csv"
        node_features: "features.csv"
        similarity_matrices:
          molecule: "sim_matrixes/dl_similarity_matrix.pkl"
          protein: "sim_matrixes/prot_similarity_matrix.pkl"
        indexes:
          drug: "indexes/drug2index.pkl"
          ligand: "indexes/ligand2index.pkl"
          protein: "indexes/prot2index.pkl"
          
    gtopdb:
      raw:
        interactions: "interactions.csv"
        ligands: "ligands.csv"
        targets: "targets_and_families.csv"
      processed:
        ligands: "gtopdb_ligands.csv"
        proteins: "gtopdb_proteins.csv"
        interactions: "gtopdb_p-l_edges.csv"

# ===================================================================
# 2. Data Processing Parameters
# ===================================================================
params:
  protein_similarity_threshold: 0.8
  max_pp_edges: 500
  molecule_similarity_threshold: 0.988 # Used for D-D, L-L
  drug_ligand_similarity_threshold: 0.7 # A separate, more lenient threshold
  gtopdb_max_affinity_nM: 10000
  negative_sampling_strategy: "popular" # Options: "uniform", "popular"
  
  # Fine-grained control for ablation studies. This will be used to generate the filename suffix.
  include_relations:
    abbreviations:
      dp_interaction: "dp"
      lp_interaction: "lp"
      pp_similarity: "pp"
      dd_similarity: "dd"
      dl_similarity: "dl"
      ll_similarity: "ll"
    flags:
      dp_interaction: true
      lp_interaction: true
      pp_similarity: true
      dd_similarity: true
      dl_similarity: true
      ll_similarity: true

# ===================================================================
# 3. Runtime Configuration
# ===================================================================
runtime:
  seed: 514
  cpus: 80
  gpu: "cuda:1"
  force_restart: false

# ===================================================================
# 4. Model Training Configuration
# ===================================================================
training:
  # The variant of the processed data to USE for this experiment run.
  data_variant: "baseline"  # Options: 'baseline', 'gtopdb'

  # --- Implicit Paradigm Definition ---
  # If 'predictor' key exists, it's 'two_stage'. Otherwise, 'end_to_end'.
  encoder: "ndls_homo"
  predictor: "gbdt"
  
  encoders:
    ndls_homo:
      k1: 200
      epsilon1: 0.03
    rgcn_hetero:
      hidden_channels: 128
      out_channels: 128
      num_layers: 2
  
  predictors:
    gbdt:
      n_estimators: 500
      max_depth: 7
      learning_rate: 0.1
      subsample: 0.8

  end_to_end:
    learning_rate: 0.001
    weight_decay: 0.0005
    epochs: 200
    batch_size: 512

  k_folds: 5

# ===================================================================
# 5. Experiment Tracking Configuration
# ===================================================================
mlflow:
  tracking_uri: "mlruns"
  experiment_name: "DTI_Prediction_Ablation_Studys